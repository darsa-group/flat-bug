# Deactivate the current environment
deactivate
echo "Current environment (1): $VIRTUAL_ENV"

# Load the necessary modules on the main node
module load python/3.11.5 opencv/4.10.0 gcc scipy-stack

# Create the virtual environment on the main node
MAIN_VENV_DIR="$SLURM_TMPDIR/env"
virtualenv --no-download "$MAIN_VENV_DIR"
source "$MAIN_VENV_DIR/bin/activate"

echo "Current environment (2): $VIRTUAL_ENV"

# Install the package in the virtual environment
pip install --no-cache-dir --no-index .

echo "Current environment (3): $VIRTUAL_ENV"
